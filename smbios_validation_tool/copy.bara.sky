"""Defines Copybara workflows for smbios validation tool.
This is a workflow for applying the copybara transformations to a local source folder.
Useful for manually constructing a copy of the repo for testing.

Usage:
$ g4d
$ copybara -v third_party/py/smbios_validation_tool/copy.bara.sky manual_folder_to_folder $(pwd)/.. --folder-dir <your_folder>
"""

origin_files = glob(
    include = [
        "google3/third_party/py/dmiparse/**",
        "google3/third_party/py/smbios_validation_tool/**",
    ],
    exclude = [
        "google3/third_party/py/dmiparse/BUILD",
        "google3/third_party/py/dmiparse/METADATA",
        "google3/third_party/py/dmiparse/OWNERS",
        "google3/third_party/py/smbios_validation_tool/BUILD",
        "google3/third_party/py/smbios_validation_tool/METADATA",
        "google3/third_party/py/smbios_validation_tool/OWNERS",
        "google3/third_party/py/smbios_validation_tool/bluze.textproto",
        "google3/third_party/py/smbios_validation_tool/smbios_validation_tool.blueprint",
    ],
)

core.workflow(
    name = "manual_folder_to_folder",
    origin = folder.origin(),
    origin_files = origin_files,
    destination = folder.destination(),
    authoring = authoring.overwrite("xuhha <xuhha@google.com>"),
    transformations = [
        core.move("google3/third_party/py/smbios_validation_tool/smbios_validation.py", "smbios_validation"),
        core.move("google3/third_party/py/smbios_validation_tool/README.md", "README.md"),
        core.move("google3/third_party/py/smbios_validation_tool/LICENSE", "LICENSE"),
        core.move("google3/third_party/py/smbios_validation_tool/CONTRIBUTING.md", "CONTRIBUTING.md"),
        core.move("google3/third_party/py/smbios_validation_tool/setup.py", "setup.py"),
        core.move("google3/third_party/py/smbios_validation_tool", "smbios_validation_tool"),
        core.move("google3/third_party/py/dmiparse", "dmiparse"),
        metadata.scrubber("^(?:\n|.)*<public>((?:\n|.)*)</public>(?:\n|.)*$", replacement = "$1"),
        leakr.check(),
    ],
)
